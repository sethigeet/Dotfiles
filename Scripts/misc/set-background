#!/bin/sh

help_message="\
usage: set-background [options]
  options:
    -h, --help                   Shows this help message
    -p, --pacwall                Generates and sets a wallpaper with pacwall
    -i, --image [image_path]     Sets the wallpaper as the given image
"

with_pacwall() {
	# Generate an image with the solid background
	convert -size 1920x1080 xc:\#1F2430 /tmp/temp-bg.png

	# Generate the pacwall image
	pacwall -k

	# Resize the image generated by pacwall
	convert "$HOME/.cache/pacwall/pacwall.png" -resize 980 "$HOME/.cache/pacwall/pacwall.png"

	# Merge both the images
	convert "/tmp/temp-bg.png" "$HOME/.cache/pacwall/pacwall.png" -gravity center -compose over -composite "$HOME/.cache/pacwall/pacwall.png"

	feh --bg-center "$HOME/.cache/pacwall/pacwall.png"
}

from_image() {
	feh --bg-scale "$1"
}

while test $# -gt 0; do
	case "$1" in
		-h | --help)
			echo "$help_message"
			exit 0
			;;
		-p | --pacwall)
			with_pacwall
			exit 0
			;;
		-i | --image)
			shift
			if test $# -gt 0; then
				from_image "$1"
				exit 0
			else
				echo "No image specified"
				exit 1
			fi
			shift
			;;
		*)
			echo "$help_message"
			exit 1
			;;
	esac
done

echo "$help_message" && exit 1
